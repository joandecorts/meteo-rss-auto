<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticker Meteorol√≤gic OBS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: transparent;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 85px;
            display: flex;
            align-items: center;
        }
        
        .ticker-container {
            width: 100%;
            height: 70px;
            background: #000;
            color: #fff;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            margin: 7px 0;
        }
        
        .legend {
            background: #000;
            color: #fff;
            padding: 0 25px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            white-space: nowrap;
            position: absolute;
            left: 0;
            z-index: 10;
            border-right: 3px solid #ffcc00;
        }
        
        .ticker-content {
            display: flex;
            align-items: center;
            position: absolute;
            left: 100%; /* COMEN√áA FORA PER LA DRETA */
            white-space: nowrap;
            animation: none; /* Controlat per JavaScript */
        }
        
        .weather-block {
            display: flex;
            align-items: center;
            margin-right: 40px;
            font-size: 22px;
            font-family: 'Arial', sans-serif;
        }
        
        .separator {
            margin: 0 25px;
            color: #ffcc00;
            font-weight: bold;
            font-size: 22px;
            font-family: 'Arial', sans-serif;
        }
        
        .city-name {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .temp-max {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .temp-min {
            color: #6bc5ff;
            font-weight: bold;
        }
        
        .temp-avg {
            color: #ffcc00;
            font-weight: bold;
        }
        
        .temp-current {
            color: #ffcc00;
            font-weight: bold;
        }
        
        .rain-amount {
            color: #66ccff;
            font-weight: bold;
        }
        
        .daily-max {
            color: #ff9966;
            font-weight: bold;
        }
        
        .daily-min {
            color: #66ccff;
            font-weight: bold;
        }
        
        /* ANIMACI√ì CORREGIDA: De dreta a esquerra */
        @keyframes ticker-scroll-right-to-left {
            0% {
                transform: translateX(0);
                left: 100%;
            }
            100% {
                transform: translateX(-100%);
                left: 0%;
            }
        }

        .loading {
            color: #cccccc;
            font-style: italic;
            font-size: 22px;
        }
    </style>
</head>
<body>
    <div class="ticker-container">
        <div class="legend">GIRON√àS-TEMPS ACTUAL- FONT: METEO.CAT</div>
        <div class="ticker-content" id="tickerContent">
            <div class="loading">Carregant dades meteorol√≤giques...</div>
        </div>
    </div>

    <script>
        // URL del RSS (mateix directori)
        const RSS_URL = 'meteo.rss';
        
        console.log("üöÄ Iniciant ticker...");

        // FUNCI√ì PER CALCULAR I INICIAR L'ANIMACI√ì EXACTA
        function startControlledAnimation(contentElement) {
            const contentWidth = contentElement.scrollWidth;
            const container = document.querySelector('.ticker-container');
            const legendWidth = 350;
            const visibleWidth = container.offsetWidth - legendWidth;
            const totalDistance = contentWidth + visibleWidth;
            const pixelsPerSecond = 60;
            const durationSeconds = totalDistance / pixelsPerSecond;
            
            console.log(`üìè Animaci√≥: ${durationSeconds.toFixed(1)}s`);
            
            contentElement.style.animation = 'none';
            void contentElement.offsetWidth;
            contentElement.style.animation = `ticker-scroll-right-to-left ${durationSeconds}s linear`;
            
            return durationSeconds;
        }

        // FUNCI√ì PER REINICIAR L'ANIMACI√ì
        function setupAnimationEndListener(contentElement, callback) {
            const onAnimationEnd = () => {
                contentElement.removeEventListener('animationend', onAnimationEnd);
                callback();
            };
            contentElement.addEventListener('animationend', onAnimationEnd);
        }

        // FUNCI√ì PER OBTENIR DADES RSS
        async function fetchWeatherData() {
            try {
                console.log(`üîç Recuperant dades...`);
                const response = await fetch(RSS_URL + '?t=' + new Date().getTime());
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const rssText = await response.text();
                
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(rssText, "text/xml");
                const items = xmlDoc.getElementsByTagName('item');
                
                if (items.length === 0) throw new Error('No hi ha dades al RSS');
                
                processRSSData(items);
                console.log('‚úÖ Dades actualitzades');
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                showError();
            }
        }

        // PROCESSAR DADES RSS
        function processRSSData(items) {
            const tickerContent = document.getElementById('tickerContent');
            let allContent = '';
            
            for (let i = 0; i < items.length; i++) {
                const title = items[i].getElementsByTagName('title')[0]?.textContent || '';
                
                if (title) {
                    let processedTitle = title
                        .replace(/üå§Ô∏è (Girona|Fornells de la Selva) \|/g, 'üå§Ô∏è <span class="city-name">$1</span> |')
                        .replace(/üìä RESUM DEL DIA (Girona|Fornells de la Selva) \|/g, 'üìä RESUM DEL DIA <span class="city-name">$1</span> |')
                        .replace(/TM: (-?[0-9.]+)¬∞C/g, 'TM: <span class="temp-avg">$1¬∞C</span>')
                        .replace(/TX: (-?[0-9.]+)¬∞C/g, 'TX: <span class="temp-max">$1¬∞C</span>')
                        .replace(/TN: (-?[0-9.]+)¬∞C/g, 'TN: <span class="temp-min">$1¬∞C</span>')
                        .replace(/PPT: (-?[0-9.]+)mm/g, 'PPT: <span class="rain-amount">$1mm</span>')
                        .replace(/VM: (-?[0-9.]+)km\/h/g, 'VM: <span class="temp-avg">$1km/h</span>')
                        .replace(/WX: (-?[0-9.]+)km\/h/g, 'WX: <span class="temp-max">$1km/h</span>')
                        .replace(/DVM: (-?[0-9.]+)¬∞/g, 'DVM: <span class="temp-avg">$1¬∞</span>')
                        .replace(/PM: (-?[0-9.]+)hPa/g, 'PM: <span class="temp-avg">$1hPa</span>')
                        .replace(/HRM: (-?[0-9.]+)%/g, 'HRM: <span class="temp-avg">$1%</span>')
                        .replace(/RS: (-?[0-9.]+)W\/m¬≤/g, 'RS: <span class="temp-avg">$1W/m¬≤</span>')
                        .replace(/üî• Temperatura M√†xima: (-?[0-9.]+)¬∞C/g, 'üî• Temperatura M√†xima: <span class="daily-max">$1¬∞C</span>')
                        .replace(/‚ùÑÔ∏è Temperatura M√≠nima: (-?[0-9.]+)¬∞C/g, '‚ùÑÔ∏è Temperatura M√≠nima: <span class="daily-min">$1¬∞C</span>')
                        .replace(/üåßÔ∏è Pluja Acumulada: (-?[0-9.]+)mm/g, 'üåßÔ∏è Pluja Acumulada: <span class="rain-amount">$1mm</span>')
                        .trim();
                    
                    allContent += `<div class="weather-block">${processedTitle}</div>`;
                    if (i < items.length - 1) allContent += '<div class="separator">||</div>';
                }
            }
            
            const finalContent = allContent + '<div class="separator">||</div>' + allContent;
            tickerContent.innerHTML = finalContent;
            
            const duration = startControlledAnimation(tickerContent);
            console.log(`üåÄ ${items.length} √≠tems, Animaci√≥: ${duration.toFixed(1)}s`);
        }

        function showError() {
            document.getElementById('tickerContent').innerHTML = 
                '<div class="loading">Error carregant dades...</div>';
            setTimeout(fetchWeatherData, 5000);
        }

        // INICIALITZACI√ì
        async function initTicker() {
            try {
                console.log("üöÄ Iniciant ticker...");
                await fetchWeatherData();
                
                const tickerContent = document.getElementById('tickerContent');
                setupAnimationEndListener(tickerContent, () => {
                    console.log("üîÑ Actualitzant...");
                    setTimeout(fetchWeatherData, 1000);
                });
                
            } catch (error) {
                console.error('‚ùå Error inicial:', error);
                setTimeout(initTicker, 10000);
            }
        }

        // INICIAR
        document.addEventListener('DOMContentLoaded', initTicker);

        // ACTUALITZACI√ì CADA 5 MINUTS
        setInterval(() => {
            console.log('üîÑ Actualitzaci√≥ programada');
            fetchWeatherData();
        }, 300000);

    </script>
</body>
</html>
