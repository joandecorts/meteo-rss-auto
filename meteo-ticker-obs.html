<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Ticker MeteorolÃ²gic OBS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: transparent; font-family: 'Arial', sans-serif; overflow: hidden; height: 85px; display: flex; align-items: center; }
        .ticker-container { width: 100%; height: 70px; background: #000; color: #fff; display: flex; align-items: center; position: relative; overflow: hidden; margin: 7px 0; }
        .legend { background: #000; color: #fff; padding: 0 25px; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; white-space: nowrap; position: absolute; left: 0; z-index: 10; border-right: 3px solid #ffcc00; }
        .ticker-content { display: flex; align-items: center; position: absolute; left: 100%; white-space: nowrap; animation: none; }
        .weather-block { display: flex; align-items: center; margin-right: 40px; font-size: 22px; font-family: 'Arial', sans-serif; }
        .separator { margin: 0 25px; color: #ffcc00; font-weight: bold; font-size: 22px; font-family: 'Arial', sans-serif; }
        
        /* TOT EN BLANC */
        .text-white { color: #ffffff; }
        .city-name { color: #4CAF50; font-weight: bold; } /* NomÃ©s noms en verd */
        
        /* ALINEACIÃ“ PERFECTA DE NÃšMEROS */
        .number-wrapper { display: inline-block; min-width: 45px; text-align: right; }
        .number { font-variant-numeric: tabular-nums; font-weight: bold; }
        .unit { margin-left: 3px; font-size: 0.9em; }
        
        /* Colors opcionals (si vols mantenir-los) */
        .temp-max { color: #ff6b6b; }
        .temp-min { color: #6bc5ff; }
        .temp-avg { color: #ffcc00; }
        .rain-amount { color: #66ccff; }
        .wind { color: #a9e34b; }
        
        @keyframes ticker-scroll-right-to-left {
            0% { transform: translateX(0); left: 100%; }
            100% { transform: translateX(-100%); left: 0%; }
        }
        .loading { color: #cccccc; font-style: italic; font-size: 22px; }
    </style>
</head>
<body>
    <div class="ticker-container">
        <div class="legend">EL TEMPS ACTUAL- FONT: METEO.CAT</div>
        <div class="ticker-content" id="tickerContent">
            <div class="loading">Carregant dades meteorolÃ²giques...</div>
        </div>
    </div>

    <script>
        const RSS_URL = 'https://joandecorts.github.io/meteo-rss-auto/meteo.rss';
        
        function startControlledAnimation(contentElement) {
            const contentWidth = contentElement.scrollWidth;
            const container = document.querySelector('.ticker-container');
            const legendWidth = 350;
            const visibleWidth = container.offsetWidth - legendWidth;
            const totalDistance = contentWidth + visibleWidth;
            const durationSeconds = totalDistance / 60;
            
            contentElement.style.animation = 'none';
            void contentElement.offsetWidth;
            contentElement.style.animation = `ticker-scroll-right-to-left ${durationSeconds}s linear`;
            return durationSeconds;
        }

        function setupAnimationEndListener(contentElement, callback) {
            const onAnimationEnd = () => {
                contentElement.removeEventListener('animationend', onAnimationEnd);
                callback();
            };
            contentElement.addEventListener('animationend', onAnimationEnd);
        }

        async function fetchWeatherData() {
            try {
                const response = await fetch(RSS_URL + '?t=' + Date.now());
                if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
                const text = await response.text();
                
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(text, "text/xml");
                const items = xmlDoc.getElementsByTagName('item');
                
                if (items.length === 0) throw new Error('No hi ha dades');
                
                processRSSData(items);
                
            } catch (error) {
                console.error('Error:', error.message);
                showError();
            }
        }

        function formatNumber(value) {
            return `<span class="number-wrapper"><span class="number">${value}</span></span>`;
        }

        function processRSSData(items) {
            const tickerContent = document.getElementById('tickerContent');
            let allContent = '';
            
            // VERSIÃ“ CATALANA COMPLETA
            for (let i = 0; i < items.length; i++) {
                const title = items[i].getElementsByTagName('title')[0]?.textContent || '';
                
                if (title) {
                    const parts = title.split(' || ');
                    let catalaPart = parts[0] || title;
                    
                    // Extreure TOTES les dades del RSS
                    let displayText = catalaPart
                        // Mantenir tot el format original perÃ² amb nÃºmeros alineats
                        .replace(/ğŸŒ¤ï¸ (Girona|Fornells de la Selva|Banyoles) \|/g, 'ğŸŒ¤ï¸ <span class="city-name">$1</span> |')
                        
                        // ACTUALITZAT I PERÃODE (mantenir text complet)
                        .replace(/Actualitzat:\s*([0-9:]+)/g, 'Actualitzat: <span class="text-white">$1</span>')
                        .replace(/PerÃ­ode:\s*([^|]+)/g, 'PerÃ­ode: <span class="text-white">$1</span>')
                        
                        // Temperatures amb nÃºmeros alineats
                        .replace(/ğŸŒ¡ï¸ Temp\. Mitjana:\s*([0-9.]+)Â°C/g, 'ğŸŒ¡ï¸ Temp. Mitjana: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">Â°C</span></span>')
                        .replace(/ğŸ”¥ Temp\. MÃ xima:\s*([0-9.]+)Â°C/g, 'ğŸ”¥ Temp. MÃ xima: <span class="temp-max">' + formatNumber('$1') + '<span class="unit">Â°C</span></span>')
                        .replace(/â„ï¸ Temp\. MÃ­nima:\s*([0-9.]+)Â°C/g, 'â„ï¸ Temp. MÃ­nima: <span class="temp-min">' + formatNumber('$1') + '<span class="unit">Â°C</span></span>')
                        
                        // Humitat i precipitaciÃ³
                        .replace(/ğŸ’§ Humitat:\s*([0-9.]+)%/g, 'ğŸ’§ Humitat: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">%</span></span>')
                        .replace(/ğŸŒ§ï¸ PrecipitaciÃ³:\s*([0-9.]+)mm/g, 'ğŸŒ§ï¸ PrecipitaciÃ³: <span class="rain-amount">' + formatNumber('$1') + '<span class="unit">mm</span></span>')
                        
                        // Vent (TOTES les dades)
                        .replace(/ğŸ’¨ Vent:\s*([0-9.]+)km\/h/g, 'ğŸ’¨ Vent: <span class="wind">' + formatNumber('$1') + '<span class="unit">km/h</span></span>')
                        .replace(/ğŸ§­ Dir\.Vent:\s*([0-9.]+)Â°/g, 'ğŸ§­ Dir.Vent: <span class="wind">' + formatNumber('$1') + '<span class="unit">Â°</span></span>')
                        .replace(/ğŸ’¨ Vent MÃ x:\s*([0-9.]+)km\/h/g, 'ğŸ’¨ Vent MÃ x: <span class="wind">' + formatNumber('$1') + '<span class="unit">km/h</span></span>')
                        
                        // PressiÃ³ i radiaciÃ³ (que faltaven)
                        .replace(/ğŸ“Š PressiÃ³:\s*([0-9.]+)hPa/g, 'ğŸ“Š PressiÃ³: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">hPa</span></span>')
                        .replace(/â˜€ï¸ RadiaciÃ³:\s*([0-9.]+)W\/mÂ²/g, 'â˜€ï¸ RadiaciÃ³: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">W/mÂ²</span></span>')
                        
                        // Netejar espais
                        .replace(/\s+/g, ' ')
                        .trim();
                    
                    // Embolcallar tot en blanc
                    displayText = `<span class="text-white">${displayText}</span>`;
                    
                    allContent += `<div class="weather-block">${displayText}</div>`;
                    if (i < items.length - 1) allContent += '<div class="separator">||</div>';
                }
            }
            
            // SEPARADOR ENTRE VERSIONS
            allContent += '<div class="separator">||</div>';
            
            // VERSIÃ“ ANGLESA COMPLETA
            for (let i = 0; i < items.length; i++) {
                const title = items[i].getElementsByTagName('title')[0]?.textContent || '';
                
                if (title) {
                    const parts = title.split(' || ');
                    let anglesPart = parts[1] || title;
                    
                    // Extreure VERSIÃ“ ANGLESA completa
                    let englishText = anglesPart
                        // Noms
                        .replace(/ğŸŒ¤ï¸ (Girona|Fornells de la Selva|Banyoles) \|/g, 'ğŸŒ¤ï¸ <span class="city-name">$1</span> |')
                        
                        // Updated i Period
                        .replace(/Updated:\s*([0-9:]+)/g, 'Updated: <span class="text-white">$1</span>')
                        .replace(/Period:\s*([^|]+)/g, 'Period: <span class="text-white">$1</span>')
                        
                        // Temperatures
                        .replace(/ğŸŒ¡ï¸ Avg Temp:\s*([0-9.]+)Â°C/g, 'ğŸŒ¡ï¸ Avg Temp: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">Â°C</span></span>')
                        .replace(/ğŸ”¥ Max Temp:\s*([0-9.]+)Â°C/g, 'ğŸ”¥ Max Temp: <span class="temp-max">' + formatNumber('$1') + '<span class="unit">Â°C</span></span>')
                        .replace(/â„ï¸ Min Temp:\s*([0-9.]+)Â°C/g, 'â„ï¸ Min Temp: <span class="temp-min">' + formatNumber('$1') + '<span class="unit">Â°C</span></span>')
                        
                        // Humidity i precipitation
                        .replace(/ğŸ’§ Humidity:\s*([0-9.]+)%/g, 'ğŸ’§ Humidity: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">%</span></span>')
                        .replace(/ğŸŒ§ï¸ Precipitation:\s*([0-9.]+)mm/g, 'ğŸŒ§ï¸ Precipitation: <span class="rain-amount">' + formatNumber('$1') + '<span class="unit">mm</span></span>')
                        
                        // Wind (totes les dades)
                        .replace(/ğŸ’¨ Wind:\s*([0-9.]+)km\/h/g, 'ğŸ’¨ Wind: <span class="wind">' + formatNumber('$1') + '<span class="unit">km/h</span></span>')
                        .replace(/ğŸ§­ Wind Dir:\s*([0-9.]+)Â°/g, 'ğŸ§­ Wind Dir: <span class="wind">' + formatNumber('$1') + '<span class="unit">Â°</span></span>')
                        .replace(/ğŸ’¨ Max Wind:\s*([0-9.]+)km\/h/g, 'ğŸ’¨ Max Wind: <span class="wind">' + formatNumber('$1') + '<span class="unit">km/h</span></span>')
                        
                        // Pressure i radiation
                        .replace(/ğŸ“Š Pressure:\s*([0-9.]+)hPa/g, 'ğŸ“Š Pressure: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">hPa</span></span>')
                        .replace(/â˜€ï¸ Radiation:\s*([0-9.]+)W\/mÂ²/g, 'â˜€ï¸ Radiation: <span class="temp-avg">' + formatNumber('$1') + '<span class="unit">W/mÂ²</span></span>')
                        
                        .replace(/\s+/g, ' ')
                        .trim();
                    
                    englishText = `<span class="text-white">${englishText}</span>`;
                    
                    allContent += `<div class="weather-block">${englishText}</div>`;
                    if (i < items.length - 1) allContent += '<div class="separator">||</div>';
                }
            }
            
            // DUPLICAR PER EFECTE CONTINU
            const finalContent = allContent + '<div class="separator">||</div>' + allContent;
            tickerContent.innerHTML = finalContent;
            
            startControlledAnimation(tickerContent);
        }

        function showError() {
            document.getElementById('tickerContent').innerHTML = 
                '<div class="loading">ActualitzaciÃ³ en curs...</div>';
            setTimeout(fetchWeatherData, 30000);
        }

        async function initTicker() {
            try {
                await fetchWeatherData();
                const tickerContent = document.getElementById('tickerContent');
                
                setupAnimationEndListener(tickerContent, () => {
                    setTimeout(() => {
                        tickerContent.style.animation = 'none';
                        void tickerContent.offsetWidth;
                        startControlledAnimation(tickerContent);
                    }, 100);
                });
                
            } catch (error) {
                setTimeout(initTicker, 10000);
            }
        }

        document.addEventListener('DOMContentLoaded', initTicker);
        setInterval(fetchWeatherData, 300000);

    </script>
</body>
</html>
