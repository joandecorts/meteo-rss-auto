# 1. ELIMINA completament aquest fitxer malament
Remove-Item ".github\workflows\update.yml" -Force

# 2. Crea un fitxer NOU amb només el YAML (sense codi PowerShell)
$correctWorkflow = @'
name: Update Meteo RSS
on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      - run: pip install requests beautifulsoup4 pytz lxml
      - run: python daily_weather_scraper.py
      - run: python generate_fullscreen_html.py
      - run: python generate_meteo_rss.py
      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./outputs
          publish_branch: gh-pages
'@

# 3. Guarda el YAML directament (NO més codi PowerShell)
[System.IO.File]::WriteAllText(
    "$PWD\.github\workflows\update.yml",
    $correctWorkflow,
    [System.Text.UTF8Encoding]::new($false)
)

# 4. VERIFICA que només hi hagi YAML dins
Write-Host "=== CONTINGUT REAL DEL FITXER ==="
Get-Content ".github\workflows\update.yml"
Write-Host "=== FI ==="

# 5. Puja
git add ".github\workflows\update.yml"
git commit -m "FIX FINAL: Correct workflow YAML file (was PowerShell code)"
git push origin main
