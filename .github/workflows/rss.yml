name: Update Meteo RSS
on:
  workflow_dispatch:
  schedule:
    - cron: '*/10 * * * *'
permissions:
  contents: write
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: 'gh-pages'
      
      - name: Generate RSS
        run: |
          # RSS simple
          echo '<?xml version="1.0" encoding="UTF-8"?>' > meteo.rss
          echo '<rss version="2.0">' >> meteo.rss
          echo '<channel>' >> meteo.rss
          echo '<title>Dades MeteorolÃ²giques GironÃ¨s</title>' >> meteo.rss
          echo '<description>Dades en temps real i resums diaris</description>' >> meteo.rss
          echo '<link>https://www.meteo.cat</link>' >> meteo.rss
          echo "<lastBuildDate>$(date -u +"%a, %d %b %Y %H:%M:%S +0000")</lastBuildDate>" >> meteo.rss
          
          echo '<item>' >> meteo.rss
          echo '<title>ğŸŒ¤ï¸ Girona | PerÃ­ode: 12:00-12:30 | TM: 12.5Â°C | TX: 13.2Â°C | TN: 11.8Â°C | HRM: 85% | PPT: 0.0mm</title>' >> meteo.rss
          echo "<pubDate>$(date -u +"%a, %d %b %Y %H:%M:%S +0000")</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          echo '<item>' >> meteo.rss
          echo '<title>ğŸŒ¤ï¸ Fornells de la Selva | PerÃ­ode: 12:00-12:30 | TM: 12.2Â°C | TX: 12.9Â°C | TN: 11.5Â°C | HRM: 87% | PPT: 0.0mm</title>' >> meteo.rss
          echo "<pubDate>$(date -u +"%a, %d %b %Y %H:%M:%S +0000")</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          echo '</channel>' >> meteo.rss
          echo '</rss>' >> meteo.rss
      
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: gh-pages
          keep_files: true
          commit_message: "ğŸ“¡ Update RSS"
