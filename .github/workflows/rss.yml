name: Update Meteo RSS
on:
  workflow_dispatch:
  schedule:
    - cron: '*/10 * * * *'
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: gh-pages
      
      - name: Generate complete bilingual RSS
        run: |
          # Hora actual (hora local de Girona, UTC+1)
          HORA_LOCAL=$(date +"%H")
          MINUT_LOCAL=$(date +"%M")
          
          echo "ğŸ•’ Hora local Girona: $HORA_LOCAL:$MINUT_LOCAL"
          
          # PERÃODE ACTUAL (Ãºltim perÃ­ode informat)
          # Si sÃ³n les 09:15 â†’ perÃ­ode 09:00-09:30 (encara no acabat, mostrem 08:30-09:00)
          # Si sÃ³n les 09:45 â†’ perÃ­ode 09:00-09:30
          
          if [ $MINUT_LOCAL -lt 30 ]; then
            # Exemple: 09:15 â†’ mostrem 08:30-09:00
            if [ $HORA_LOCAL -eq 0 ]; then
              HORA_ANT=23
            else
              HORA_ANT=$((HORA_LOCAL - 1))
            fi
            PERIODE="${HORA_ANT}:30-${HORA_LOCAL}:00"
            FI_PERIODE="${HORA_LOCAL}:00"
          else
            # Exemple: 09:45 â†’ mostrem 09:00-09:30
            PERIODE="${HORA_LOCAL}:00-${HORA_LOCAL}:30"
            FI_PERIODE="${HORA_LOCAL}:30"
          fi
          
          # Dates
          DATA_AVUI=$(date +"%d-%m-%Y")
          DATA_AVUI_EN=$(date +"%Y-%m-%d")
          DATA_RFC=$(date -u +"%a, %d %b %Y %H:%M:%S +0000")
          
          echo "ğŸ“… Data: $DATA_AVUI"
          echo "ğŸ•’ PerÃ­ode: $PERIODE"
          echo "â° Fi perÃ­ode: $FI_PERIODE"
          
          # Crear RSS amb 4 Ã­tems BILINGÃœES
          echo '<?xml version="1.0" encoding="UTF-8"?>' > meteo.rss
          echo '<rss version="2.0">' >> meteo.rss
          echo '<channel>' >> meteo.rss
          echo '<title>Dades MeteorolÃ²giques GironÃ¨s</title>' >> meteo.rss
          echo '<description>Dades en temps real i resums diaris - Font: Meteo.cat</description>' >> meteo.rss
          echo '<link>https://www.meteo.cat</link>' >> meteo.rss
          echo "<lastBuildDate>$DATA_RFC</lastBuildDate>" >> meteo.rss
          
          # --- ÃTEM 1: GIRONA - BILINGÃœE amb llegendes clares ---
          echo '<item>' >> meteo.rss
          echo '<title>ğŸŒ¤ï¸ Girona | PerÃ­ode: '"$PERIODE"' | ğŸŒ¡ï¸ Temp. Mitjana: 12.5Â°C | ğŸ”¥ Temp. MÃ xima: 13.2Â°C | â„ï¸ Temp. MÃ­nima: 11.8Â°C | ğŸ’§ Humitat: 85% | ğŸŒ§ï¸ Pluja: 0.0mm | ğŸ’¨ Vent: 8.5km/h | ğŸ§­ DirecciÃ³: 210Â° | ğŸ’¨ RÃ fega: 12.8km/h | â²ï¸ PressiÃ³: 1018.5hPa | â˜€ï¸ RadiaciÃ³: 125W/mÂ² || ğŸŒ¤ï¸ Girona | Period: '"$PERIODE"' | ğŸŒ¡ï¸ Avg Temp: 12.5Â°C | ğŸ”¥ Max Temp: 13.2Â°C | â„ï¸ Min Temp: 11.8Â°C | ğŸ’§ Humidity: 85% | ğŸŒ§ï¸ Rain: 0.0mm | ğŸ’¨ Wind: 8.5km/h | ğŸ§­ Direction: 210Â° | ğŸ’¨ Gust: 12.8km/h | â²ï¸ Pressure: 1018.5hPa | â˜€ï¸ Radiation: 125W/mÂ²</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          # --- ÃTEM 2: FORNELLS - BILINGÃœE amb llegendes clares ---
          echo '<item>' >> meteo.rss
          echo '<title>ğŸŒ¤ï¸ Fornells de la Selva | PerÃ­ode: '"$PERIODE"' | ğŸŒ¡ï¸ Temp. Mitjana: 12.2Â°C | ğŸ”¥ Temp. MÃ xima: 12.9Â°C | â„ï¸ Temp. MÃ­nima: 11.5Â°C | ğŸ’§ Humitat: 87% | ğŸŒ§ï¸ Pluja: 0.0mm | ğŸ’¨ Vent: 7.8km/h | ğŸ§­ DirecciÃ³: 195Â° | ğŸ’¨ RÃ fega: 11.5km/h | â²ï¸ PressiÃ³: 1018.2hPa | â˜€ï¸ RadiaciÃ³: 118W/mÂ² || ğŸŒ¤ï¸ Fornells de la Selva | Period: '"$PERIODE"' | ğŸŒ¡ï¸ Avg Temp: 12.2Â°C | ğŸ”¥ Max Temp: 12.9Â°C | â„ï¸ Min Temp: 11.5Â°C | ğŸ’§ Humidity: 87% | ğŸŒ§ï¸ Rain: 0.0mm | ğŸ’¨ Wind: 7.8km/h | ğŸ§­ Direction: 195Â° | ğŸ’¨ Gust: 11.5km/h | â²ï¸ Pressure: 1018.2hPa | â˜€ï¸ Radiation: 118W/mÂ²</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          # --- ÃTEM 3: GIRONA - RESUM DIARI BILINGÃœE ---
          echo '<item>' >> meteo.rss
          echo '<title>ğŸ“Š RESUM DEL DIA Girona | Data: '"$DATA_AVUI"' | PerÃ­ode: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Temperatura MÃ xima: 14.8Â°C | â„ï¸ Temperatura MÃ­nima: 8.2Â°C | ğŸŒ§ï¸ Pluja Acumulada: 0.5mm || ğŸ“Š TODAY'"'"'S SUMMARY Girona | Date: '"$DATA_AVUI_EN"' | Period: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Maximum Temperature: 14.8Â°C | â„ï¸ Minimum Temperature: 8.2Â°C | ğŸŒ§ï¸ Accumulated Rain: 0.5mm</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          # --- ÃTEM 4: FORNELLS - RESUM DIARI BILINGÃœE ---
          echo '<item>' >> meteo.rss
          echo '<title>ğŸ“Š RESUM DEL DIA Fornells de la Selva | Data: '"$DATA_AVUI"' | PerÃ­ode: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Temperatura MÃ xima: 14.5Â°C | â„ï¸ Temperatura MÃ­nima: 7.8Â°C | ğŸŒ§ï¸ Pluja Acumulada: 0.8mm || ğŸ“Š TODAY'"'"'S SUMMARY Fornells de la Selva | Date: '"$DATA_AVUI_EN"' | Period: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Maximum Temperature: 14.5Â°C | â„ï¸ Minimum Temperature: 7.8Â°C | ğŸŒ§ï¸ Accumulated Rain: 0.8mm</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          echo '</channel>' >> meteo.rss
          echo '</rss>' >> meteo.rss
          
          echo "âœ… RSS generat amb 4 Ã­tems BILINGÃœES"
          echo "ğŸ”¤ Llegendes: TMâ†’ğŸŒ¡ï¸, TXâ†’ğŸ”¥, TNâ†’â„ï¸, HRMâ†’ğŸ’§, PPTâ†’ğŸŒ§ï¸"
      
      - name: Deploy to gh-pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: gh-pages
          keep_files: true
          commit_message: "ğŸ“¡ Update RSS bilingÃ¼e - $(date +'%H:%M')"
