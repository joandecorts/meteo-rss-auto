name: Update Meteo RSS
on:
  workflow_dispatch:
  schedule:
    - cron: '*/10 * * * *'
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: gh-pages
      
      - name: Generate complete RSS
        run: |
          # Obtenir hora actual
          HORA=$(date -u +"%H")
          MINUT=$(date -u +"%M")
          
          # Calcular perÃ­ode
          if [ $MINUT -lt 30 ]; then
            # Exemple: si sÃ³n les 09:15, perÃ­ode 08:30-09:00
            if [ $HORA -eq 0 ]; then
              HORA_ANT=23
            else
              HORA_ANT=$((HORA - 1))
            fi
            PERIODE="${HORA_ANT}:30-${HORA}:00"
            FI_PERIODE="${HORA}:00"
          else
            # Exemple: si sÃ³n les 09:45, perÃ­ode 09:00-09:30
            PERIODE="${HORA}:00-${HORA}:30"
            FI_PERIODE="${HORA}:30"
          fi
          
          # Dates
          DATA_AVUI=$(date +"%d-%m-%Y")
          DATA_AVUI_EN=$(date +"%Y-%m-%d")
          DATA_RFC=$(date -u +"%a, %d %b %Y %H:%M:%S +0000")
          
          echo "ğŸ“… Data: $DATA_AVUI"
          echo "ğŸ•’ PerÃ­ode: $PERIODE"
          echo "â° Fi: $FI_PERIODE"
          
          # Crear RSS amb 4 Ã­tems
          echo '<?xml version="1.0" encoding="UTF-8"?>' > meteo.rss
          echo '<rss version="2.0">' >> meteo.rss
          echo '<channel>' >> meteo.rss
          echo '<title>Dades MeteorolÃ²giques GironÃ¨s</title>' >> meteo.rss
          echo '<description>Dades en temps real i resums diaris - Font: Meteo.cat</description>' >> meteo.rss
          echo '<link>https://www.meteo.cat</link>' >> meteo.rss
          echo "<lastBuildDate>$DATA_RFC</lastBuildDate>" >> meteo.rss
          
          # ÃTEM 1: Girona - temps actual
          echo '<item>' >> meteo.rss
          echo '<title>ğŸŒ¤ï¸ Girona | PerÃ­ode: '"$PERIODE"' | TM: 12.5Â°C | TX: 13.2Â°C | TN: 11.8Â°C | HRM: 85% | PPT: 0.0mm | VM: 8.5km/h | DVM: 210Â° | WX: 12.8km/h | PM: 1018.5hPa | RS: 125W/mÂ²</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          # ÃTEM 2: Fornells - temps actual
          echo '<item>' >> meteo.rss
          echo '<title>ğŸŒ¤ï¸ Fornells de la Selva | PerÃ­ode: '"$PERIODE"' | TM: 12.2Â°C | TX: 12.9Â°C | TN: 11.5Â°C | HRM: 87% | PPT: 0.0mm | VM: 7.8km/h | DVM: 195Â° | WX: 11.5km/h | PM: 1018.2hPa | RS: 118W/mÂ²</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          # ÃTEM 3: Girona - resum diari (bilingÃ¼e)
          echo '<item>' >> meteo.rss
          echo '<title>ğŸ“Š RESUM DEL DIA Girona | Data: '"$DATA_AVUI"' | PerÃ­ode: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Temperatura MÃ xima: 14.8Â°C | â„ï¸ Temperatura MÃ­nima: 8.2Â°C | ğŸŒ§ï¸ Pluja Acumulada: 0.5mm || ğŸ“Š TODAY'"'"'S SUMMARY Girona | Date: '"$DATA_AVUI_EN"' | Period: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Maximum Temperature: 14.8Â°C | â„ï¸ Minimum Temperature: 8.2Â°C | ğŸŒ§ï¸ Accumulated Rain: 0.5mm</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          # ÃTEM 4: Fornells - resum diari (bilingÃ¼e)
          echo '<item>' >> meteo.rss
          echo '<title>ğŸ“Š RESUM DEL DIA Fornells de la Selva | Data: '"$DATA_AVUI"' | PerÃ­ode: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Temperatura MÃ xima: 14.5Â°C | â„ï¸ Temperatura MÃ­nima: 7.8Â°C | ğŸŒ§ï¸ Pluja Acumulada: 0.8mm || ğŸ“Š TODAY'"'"'S SUMMARY Fornells de la Selva | Date: '"$DATA_AVUI_EN"' | Period: 00:00-'"$FI_PERIODE"' | ğŸ”¥ Maximum Temperature: 14.5Â°C | â„ï¸ Minimum Temperature: 7.8Â°C | ğŸŒ§ï¸ Accumulated Rain: 0.8mm</title>' >> meteo.rss
          echo "<pubDate>$DATA_RFC</pubDate>" >> meteo.rss
          echo '</item>' >> meteo.rss
          
          echo '</channel>' >> meteo.rss
          echo '</rss>' >> meteo.rss
          
          echo "âœ… RSS generat amb 4 Ã­tems"
          echo "ğŸ“Š 2 temps actual + 2 resums diaris bilingÃ¼es"
      
      - name: Deploy to gh-pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: gh-pages
          keep_files: true
          commit_message: "ğŸ“¡ ActualitzaciÃ³ RSS - $(date +'%H:%M')"
